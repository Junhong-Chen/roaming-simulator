(function(){"use strict";const St=.5*(Math.sqrt(3)-1),K=(3-Math.sqrt(3))/6,Xt=1/3,_=1/6,kt=(Math.sqrt(5)-1)/4,U=(5-Math.sqrt(5))/20,I=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),z=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class wt{constructor(o=Math.random){const e=typeof o=="function"?o:Zt(o);this.p=Ft(e),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let c=0;c<512;c++)this.perm[c]=this.p[c&255],this.permMod12[c]=this.perm[c]%12}noise2D(o,e){const c=this.permMod12,M=this.perm;let r=0,g=0,x=0;const j=(o+e)*St,R=Math.floor(o+j),b=Math.floor(e+j),Y=(R+b)*K,C=R-Y,G=b-Y,Z=o-C,t=e-G;let T,N;Z>t?(T=1,N=0):(T=0,N=1);const D=Z-T+K,q=t-N+K,h=Z-1+2*K,i=t-1+2*K,S=R&255,X=b&255;let y=.5-Z*Z-t*t;if(y>=0){const s=c[S+M[X]]*3;y*=y,r=y*y*(I[s]*Z+I[s+1]*t)}let k=.5-D*D-q*q;if(k>=0){const s=c[S+T+M[X+N]]*3;k*=k,g=k*k*(I[s]*D+I[s+1]*q)}let l=.5-h*h-i*i;if(l>=0){const s=c[S+1+M[X+1]]*3;l*=l,x=l*l*(I[s]*h+I[s+1]*i)}return 70*(r+g+x)}noise3D(o,e,c){const M=this.permMod12,r=this.perm;let g,x,j,R;const b=(o+e+c)*Xt,Y=Math.floor(o+b),C=Math.floor(e+b),G=Math.floor(c+b),Z=(Y+C+G)*_,t=Y-Z,T=C-Z,N=G-Z,D=o-t,q=e-T,h=c-N;let i,S,X,y,k,l;D>=q?q>=h?(i=1,S=0,X=0,y=1,k=1,l=0):D>=h?(i=1,S=0,X=0,y=1,k=0,l=1):(i=0,S=0,X=1,y=1,k=0,l=1):q<h?(i=0,S=0,X=1,y=0,k=1,l=1):D<h?(i=0,S=1,X=0,y=0,k=1,l=1):(i=0,S=1,X=0,y=1,k=1,l=0);const s=D-i+_,P=q-S+_,V=h-X+_,n=D-y+2*_,d=q-k+2*_,a=h-l+2*_,u=D-1+3*_,p=q-1+3*_,w=h-1+3*_,v=Y&255,A=C&255,m=G&255;let W=.6-D*D-q*q-h*h;if(W<0)g=0;else{const E=M[v+r[A+r[m]]]*3;W*=W,g=W*W*(I[E]*D+I[E+1]*q+I[E+2]*h)}let J=.6-s*s-P*P-V*V;if(J<0)x=0;else{const E=M[v+i+r[A+S+r[m+X]]]*3;J*=J,x=J*J*(I[E]*s+I[E+1]*P+I[E+2]*V)}let B=.6-n*n-d*d-a*a;if(B<0)j=0;else{const E=M[v+y+r[A+k+r[m+l]]]*3;B*=B,j=B*B*(I[E]*n+I[E+1]*d+I[E+2]*a)}let H=.6-u*u-p*p-w*w;if(H<0)R=0;else{const E=M[v+1+r[A+1+r[m+1]]]*3;H*=H,R=H*H*(I[E]*u+I[E+1]*p+I[E+2]*w)}return 32*(g+x+j+R)}noise4D(o,e,c,M){const r=this.perm;let g,x,j,R,b;const Y=(o+e+c+M)*kt,C=Math.floor(o+Y),G=Math.floor(e+Y),Z=Math.floor(c+Y),t=Math.floor(M+Y),T=(C+G+Z+t)*U,N=C-T,D=G-T,q=Z-T,h=t-T,i=o-N,S=e-D,X=c-q,y=M-h;let k=0,l=0,s=0,P=0;i>S?k++:l++,i>X?k++:s++,i>y?k++:P++,S>X?l++:s++,S>y?l++:P++,X>y?s++:P++;const V=k>=3?1:0,n=l>=3?1:0,d=s>=3?1:0,a=P>=3?1:0,u=k>=2?1:0,p=l>=2?1:0,w=s>=2?1:0,v=P>=2?1:0,A=k>=1?1:0,m=l>=1?1:0,W=s>=1?1:0,J=P>=1?1:0,B=i-V+U,H=S-n+U,E=X-d+U,rt=y-a+U,lt=i-u+2*U,at=S-p+2*U,ft=X-w+2*U,ut=y-v+2*U,ht=i-A+3*U,dt=S-m+3*U,mt=X-W+3*U,yt=y-J+3*U,gt=i-1+4*U,pt=S-1+4*U,Mt=X-1+4*U,vt=y-1+4*U,L=C&255,O=G&255,Q=Z&255,$=t&255;let tt=.6-i*i-S*S-X*X-y*y;if(tt<0)g=0;else{const F=r[L+r[O+r[Q+r[$]]]]%32*4;tt*=tt,g=tt*tt*(z[F]*i+z[F+1]*S+z[F+2]*X+z[F+3]*y)}let nt=.6-B*B-H*H-E*E-rt*rt;if(nt<0)x=0;else{const F=r[L+V+r[O+n+r[Q+d+r[$+a]]]]%32*4;nt*=nt,x=nt*nt*(z[F]*B+z[F+1]*H+z[F+2]*E+z[F+3]*rt)}let ot=.6-lt*lt-at*at-ft*ft-ut*ut;if(ot<0)j=0;else{const F=r[L+u+r[O+p+r[Q+w+r[$+v]]]]%32*4;ot*=ot,j=ot*ot*(z[F]*lt+z[F+1]*at+z[F+2]*ft+z[F+3]*ut)}let st=.6-ht*ht-dt*dt-mt*mt-yt*yt;if(st<0)R=0;else{const F=r[L+A+r[O+m+r[Q+W+r[$+J]]]]%32*4;st*=st,R=st*st*(z[F]*ht+z[F+1]*dt+z[F+2]*mt+z[F+3]*yt)}let et=.6-gt*gt-pt*pt-Mt*Mt-vt*vt;if(et<0)b=0;else{const F=r[L+1+r[O+1+r[Q+1+r[$+1]]]]%32*4;et*=et,b=et*et*(z[F]*gt+z[F+1]*pt+z[F+2]*Mt+z[F+3]*vt)}return 27*(g+x+j+R+b)}}function Ft(f){const o=new Uint8Array(256);for(let e=0;e<256;e++)o[e]=e;for(let e=0;e<255;e++){const c=e+~~(f()*(256-e)),M=o[e];o[e]=o[c],o[c]=M}return o}function Zt(f){let o=0,e=0,c=0,M=1;const r=bt();return o=r(" "),e=r(" "),c=r(" "),o-=r(f),o<0&&(o+=1),e-=r(f),e<0&&(e+=1),c-=r(f),c<0&&(c+=1),function(){const g=2091639*o+M*23283064365386963e-26;return o=e,e=c,c=g-(M=g|0)}}function bt(){let f=4022871197;return function(o){o=o.toString();for(let e=0;e<o.length;e++){f+=o.charCodeAt(e);let c=.02519603282416938*f;f=c>>>0,c-=f,c*=f,f=c>>>0,c-=f,f+=c*4294967296}return(f>>>0)*23283064365386963e-26}}var ct=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var f=0,o=arguments.length;o--;)f+=arguments[o]*arguments[o];return Math.sqrt(f)});function xt(){var f=new ct(3);return ct!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0),f}function it(f,o,e){var c=new ct(3);return c[0]=f,c[1]=o,c[2]=e,c}function jt(f,o){var e=o[0],c=o[1],M=o[2],r=e*e+c*c+M*M;return r>0&&(r=1/Math.sqrt(r)),f[0]=o[0]*r,f[1]=o[1]*r,f[2]=o[2]*r,f}function zt(f,o,e){var c=o[0],M=o[1],r=o[2],g=e[0],x=e[1],j=e[2];return f[0]=M*j-r*x,f[1]=r*g-c*j,f[2]=c*x-M*g,f}(function(){var f=xt();return function(o,e,c,M,r,g){var x,j;for(e||(e=3),c||(c=0),M?j=Math.min(M*e+c,o.length):j=o.length,x=c;x<j;x+=e)f[0]=o[x],f[1]=o[x+1],f[2]=o[x+2],r(f,f,g),o[x]=f[0],o[x+1]=f[1],o[x+2]=f[2];return o}})();let At=null;const qt=(f,o,e,c,M,r,g,x,j,R)=>{let b=0,Y=r,C=1,G=0;for(let Z=0;Z<M;Z++){const t=At.noise2D(f*Y+R[Z][0],o*Y+R[Z][1]);b+=t*C,G+=C,C*=c,Y*=e}return b/=G,b=Math.pow(Math.abs(b),x)*Math.sign(b),b*=g,b+=j,b};onmessage=function(f){const{id:o,size:e,x:c,z:M,seed:r,subdivisions:g,lacunarity:x,persistence:j,iterations:R,baseFrequency:b,baseAmplitude:Y,power:C,elevationOffset:G,iterationsOffsets:Z}=f.data,t=g+1;At=new wt(r);const T=new wt(r),N=new Float32Array((t+1)*(t+1)),D=new Float32Array(t*t);for(let n=0;n<t+1;n++){const d=c+(n/g-.5)*e;for(let a=0;a<t+1;a++){const u=M+(a/g-.5)*e,p=qt(d,u,x,j,R,b,Y,C,G,Z),w=a*(t+1)+n;if(N[w]=p,n<t&&a<t){const v=a*t+n;D[v]=p}}}const q=g*4+4,h=new Float32Array(t*t*3+q*3);for(let n=0;n<t;n++){const d=M+(n/g-.5)*e;for(let a=0;a<t;a++){const u=c+(a/g-.5)*e,p=D[n*t+a],w=(n*t+a)*3;h[w]=u,h[w+1]=p,h[w+2]=d}}const i=new Float32Array(t*t*3+q*3),S=-e/g,X=-e/g;for(let n=0;n<t;n++)for(let d=0;d<t;d++){const a=n*(t+1)+d,u=N[a],p=N[a+1],w=N[a+t+1],v=it(S,u-p,0),A=it(0,u-w,X),m=xt();zt(m,A,v),jt(m,m);const W=(n*t+d)*3;i[W]=m[0],i[W+1]=m[1],i[W+2]=m[2]}const y=new Float32Array(t*t*2+q*2);for(let n=0;n<t;n++)for(let d=0;d<t;d++){const a=(n*t+d)*2;y[a]=d/(t-1),y[a+1]=n/(t-1)}const k=g*g,l=new(k<65535?Uint16Array:Uint32Array)(k*6+g*4*6*4);for(let n=0;n<g;n++)for(let d=0;d<g;d++){const a=g+1,u=n*a+d,p=n*a+(d+1),w=(n+1)*a+d,v=(n+1)*a+(d+1),A=(n*g+d)*6;l[A]=u,l[A+1]=v,l[A+2]=p,l[A+3]=v,l[A+4]=u,l[A+5]=w}let s=t*t,P=t*t;for(let n=0;n<t;n++){const a=0*t+n,u=a*3;if(h[s*3]=h[u+0],h[s*3+1]=h[u+1]-15,h[s*3+2]=h[u+2],i[s*3]=i[u+0],i[s*3+1]=i[u+1],i[s*3+2]=i[u+2],y[s*2]=0/(t-1),y[s*2+1]=n/(t-1),n<t-1){const p=a,w=a+1,v=s,A=s+1,m=P*6;l[m]=w,l[m+1]=A,l[m+2]=p,l[m+3]=v,l[m+4]=p,l[m+5]=A,P++}s++}for(let n=0;n<t;n++){const d=t-1,a=d*t+n,u=a*3;if(h[s*3]=h[u+0],h[s*3+1]=h[u+1]-15,h[s*3+2]=h[u+2],i[s*3]=i[u+0],i[s*3+1]=i[u+1],i[s*3+2]=i[u+2],y[s*2]=d/(t-1),y[s*2+1]=n/(t-1),n<t-1){const p=a,w=a+1,v=s,A=s+1,m=P*6;l[m]=p,l[m+1]=v,l[m+2]=w,l[m+3]=A,l[m+4]=w,l[m+5]=v,P++}s++}for(let n=0;n<t;n++){const a=n*t+0,u=a*3;if(h[s*3]=h[u+0],h[s*3+1]=h[u+1]-15,h[s*3+2]=h[u+2],i[s*3]=i[u+0],i[s*3+1]=i[u+1],i[s*3+2]=i[u+2],y[s*2]=n/(t-1),y[s*2+1]=0,n<t-1){const p=a,w=a+t,v=s,A=s+1,m=P*6;l[m]=p,l[m+1]=v,l[m+2]=w,l[m+3]=A,l[m+4]=w,l[m+5]=v,P++}s++}for(let n=0;n<t;n++){const d=t-1,a=n*t+d,u=a*3;if(h[s*3]=h[u+0],h[s*3+1]=h[u+1]-15,h[s*3+2]=h[u+2],i[s*3]=i[u+0],i[s*3+1]=i[u+1],i[s*3+2]=i[u+2],y[s*2]=n/(t-1),y[s*2+1]=d/(t-1),n<t-1){const p=a,w=a+t,v=s,A=s+1,m=P*6;l[m]=w,l[m+1]=A,l[m+2]=p,l[m+3]=v,l[m+4]=p,l[m+5]=A,P++}s++}const V=new Float32Array(t*t*4);for(let n=0;n<t;n++)for(let d=0;d<t;d++){const a=(n*t+d)*3,u=it(h[a],h[a+1],h[a+2]),p=(n*t+d)*3,w=it(i[p],i[p+1],i[p+2]);Math.max(0,w[1]),u[1]>0&&T.noise2D(u[0]*.05+Z[0][0],u[2]*.05+Z[0][0]);const v=(n*t+d)*4;V[v]=i[p],V[v+1]=i[p+1],V[v+2]=i[p+2],V[v+3]=u[1]}postMessage({id:o,positions:h,normals:i,indices:l,texture:V,uv:y})}})();
